---
// Компонент для калькулятора перевода баллов ЕГЭ
---

<div class="calc" id="ege-calc" role="region" aria-labelledby="ege-calc-title">
  <h2 id="ege-calc-title" class="calc__title">Калькулятор шкалы перевода баллов ЕГЭ</h2>
  <div class="calc__row">
    <label class="calc__label">
      Предмет
      <select id="subject" class="calc__select">
        <option value="math-pro">Математика (профиль)</option>
        <option value="russian">Русский язык</option>
        <option value="chemistry">Химия</option>
        <option value="biology">Биология</option>
        <option value="physics">Физика</option>
        <option value="history">История</option>
        <option value="literature">Литература</option>
        <option value="social">Обществознание</option>
        <option value="informatics">Информатика</option>
        <option value="geography">География</option>
        <option value="foreign-lang">Иностранные языки</option>
        <option value="chinese">Китайский язык</option>
      </select>
    </label>
    <label class="calc__label" for="ege-calc-primary">
      Первичные баллы
      <input
        id="ege-calc-primary"
        type="number"
        min="0"
        step="1"
        placeholder="например, 23"
        class="calc__input"
        aria-describedby="ege-calc-note"
      />
    </label>
  </div>
  <button id="calc-btn" type="button" class="calc__btn" aria-label="Рассчитать тестовые баллы">Посчитать</button>
  <div class="calc__result" id="result" role="status" aria-live="polite" aria-atomic="true"></div>
  <p id="ege-calc-note" class="calc__note">
    Результат округляется согласно официальной таблице соответствий для 2025 года.
  </p>
</div>

<style>
  .calc {
    margin-top: 24px;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
  }
  .calc__title {
    margin: 0 0 12px;
    font-size: clamp(1.1rem, 2.5vw, 1.35rem);
  }
  .calc__row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 12px;
  }
  .calc__label {
    flex: 1 1 min(100%, 220px);
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 6px;
    font-size: 14px;
  }
  .calc__select,
  .calc__input {
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
  }
  .calc__btn {
    padding: 10px 12px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    background: var(--blue);
    color: white;
  }
  .calc__btn:hover {
    filter: brightness(1.05);
  }
  .calc__result {
    margin-top: 12px;
    font-weight: 600;
  }
  .calc__note {
    color: var(--gray);
    font-size: 13px;
    margin: 8px 0 0;
  }
</style>

<script is:inline>
  (function () {
    const maps = {
      "math-pro": {
        1: 6,
        2: 11,
        3: 17,
        4: 22,
        5: 27,
        6: 34,
        7: 40,
        8: 46,
        9: 52,
        10: 58,
        11: 64,
        12: 70,
        13: 72,
        14: 74,
        15: 76,
        16: 78,
        17: 80,
        18: 82,
        19: 84,
        20: 86,
        21: 88,
        22: 90,
        23: 92,
        24: 94,
        25: 95,
        26: 96,
        27: 97,
        28: 98,
        29: 99,
        30: 100,
        31: 100,
        32: 100,
      },
      russian: {
        1: 3,
        2: 5,
        3: 8,
        4: 10,
        5: 12,
        6: 15,
        7: 17,
        8: 20,
        9: 22,
        10: 24,
        11: 27,
        12: 29,
        13: 32,
        14: 34,
        15: 36,
        16: 37,
        17: 39,
        18: 40,
        19: 42,
        20: 43,
        21: 45,
        22: 46,
        23: 48,
        24: 49,
        25: 51,
        26: 52,
        27: 54,
        28: 55,
        29: 57,
        30: 58,
        31: 60,
        32: 61,
        33: 63,
        34: 64,
        35: 66,
        36: 67,
        37: 69,
        38: 70,
        39: 72,
        40: 73,
        41: 75,
        42: 78,
        43: 81,
        44: 83,
        45: 86,
        46: 89,
        47: 91,
        48: 94,
        49: 99,
        50: 100,
      },
      chemistry: {
        1: 4,
        2: 7,
        3: 10,
        4: 14,
        5: 17,
        6: 20,
        7: 23,
        8: 27,
        9: 30,
        10: 33,
        11: 36,
        12: 38,
        13: 39,
        14: 40,
        15: 42,
        16: 43,
        17: 44,
        18: 46,
        19: 47,
        20: 48,
        21: 49,
        22: 51,
        23: 52,
        24: 53,
        25: 55,
        26: 56,
        27: 57,
        28: 58,
        29: 60,
        30: 61,
        31: 62,
        32: 64,
        33: 65,
        34: 66,
        35: 68,
        36: 69,
        37: 70,
        38: 71,
        39: 73,
        40: 74,
        41: 75,
        42: 77,
        43: 78,
        44: 79,
        45: 80,
        46: 82,
        47: 84,
        48: 86,
        49: 88,
        50: 90,
        51: 91,
        52: 93,
        53: 95,
        54: 97,
        55: 99,
        56: 100,
      },
      biology: {
        1: 3,
        2: 5,
        3: 7,
        4: 10,
        5: 12,
        6: 14,
        7: 17,
        8: 19,
        9: 21,
        10: 24,
        11: 26,
        12: 28,
        13: 31,
        14: 33,
        15: 36,
        16: 38,
        17: 40,
        18: 41,
        19: 43,
        20: 45,
        21: 46,
        22: 48,
        23: 50,
        24: 51,
        25: 53,
        26: 55,
        27: 56,
        28: 58,
        29: 60,
        30: 61,
        31: 63,
        32: 65,
        33: 66,
        34: 68,
        35: 70,
        36: 71,
        37: 72,
        38: 73,
        39: 74,
        40: 75,
        41: 76,
        42: 77,
        43: 78,
        44: 79,
        45: 80,
        46: 81,
        47: 83,
        48: 85,
        49: 86,
        50: 88,
        51: 90,
        52: 91,
        53: 93,
        54: 95,
        55: 96,
        56: 98,
        57: 100,
      },
      physics: {
        1: 5,
        2: 9,
        3: 14,
        4: 18,
        5: 23,
        6: 27,
        7: 32,
        8: 36,
        9: 39,
        10: 41,
        11: 43,
        12: 44,
        13: 46,
        14: 48,
        15: 49,
        16: 51,
        17: 53,
        18: 54,
        19: 56,
        20: 58,
        21: 59,
        22: 61,
        23: 62,
        24: 64,
        25: 65,
        26: 67,
        27: 68,
        28: 70,
        29: 71,
        30: 73,
        31: 74,
        32: 76,
        33: 77,
        34: 79,
        35: 80,
        36: 82,
        37: 84,
        38: 86,
        39: 88,
        40: 90,
        41: 92,
        42: 94,
        43: 96,
        44: 98,
        45: 100,
      },
      history: {
        1: 4,
        2: 8,
        3: 12,
        4: 16,
        5: 20,
        6: 24,
        7: 28,
        8: 32,
        9: 34,
        10: 36,
        11: 38,
        12: 40,
        13: 42,
        14: 44,
        15: 45,
        16: 47,
        17: 49,
        18: 51,
        19: 53,
        20: 55,
        21: 57,
        22: 58,
        23: 60,
        24: 62,
        25: 64,
        26: 66,
        27: 68,
        28: 70,
        29: 72,
        30: 74,
        31: 76,
        32: 78,
        33: 80,
        34: 82,
        35: 84,
        36: 87,
        37: 89,
        38: 91,
        39: 93,
        40: 95,
        41: 97,
        42: 100,
      },
      literature: {
        1: 3,
        2: 5,
        3: 8,
        4: 10,
        5: 13,
        6: 15,
        7: 18,
        8: 20,
        9: 23,
        10: 25,
        11: 28,
        12: 30,
        13: 32,
        14: 34,
        15: 35,
        16: 36,
        17: 37,
        18: 38,
        19: 39,
        20: 40,
        21: 41,
        22: 42,
        23: 43,
        24: 44,
        25: 45,
        26: 46,
        27: 47,
        28: 49,
        29: 50,
        30: 51,
        31: 52,
        32: 53,
        33: 54,
        34: 55,
        35: 56,
        36: 57,
        37: 58,
        38: 59,
        39: 60,
        40: 61,
        41: 63,
        42: 68,
        43: 73,
        44: 78,
        45: 84,
        46: 89,
        47: 94,
        48: 100,
      },
      social: {
        1: 2,
        2: 4,
        3: 6,
        4: 8,
        5: 10,
        6: 12,
        7: 14,
        8: 16,
        9: 18,
        10: 20,
        11: 22,
        12: 24,
        13: 26,
        14: 28,
        15: 30,
        16: 32,
        17: 34,
        18: 36,
        19: 38,
        20: 40,
        21: 42,
        22: 44,
        23: 45,
        24: 47,
        25: 48,
        26: 49,
        27: 51,
        28: 52,
        29: 53,
        30: 55,
        31: 56,
        32: 57,
        33: 59,
        34: 60,
        35: 62,
        36: 63,
        37: 64,
        38: 66,
        39: 67,
        40: 68,
        41: 70,
        42: 71,
        43: 72,
        44: 73,
        45: 75,
        46: 77,
        47: 79,
        48: 81,
        49: 83,
        50: 85,
        51: 86,
        52: 88,
        53: 90,
        54: 92,
        55: 94,
        56: 96,
        57: 98,
        58: 100,
      },
      informatics: {
        1: 7,
        2: 14,
        3: 20,
        4: 27,
        5: 34,
        6: 40,
        7: 43,
        8: 46,
        9: 48,
        10: 51,
        11: 54,
        12: 56,
        13: 59,
        14: 62,
        15: 64,
        16: 67,
        17: 70,
        18: 72,
        19: 75,
        20: 78,
        21: 80,
        22: 83,
        23: 85,
        24: 88,
        25: 90,
        26: 93,
        27: 95,
        28: 98,
        29: 100,
      },
      geography: {
        1: 5,
        2: 9,
        3: 13,
        4: 17,
        5: 21,
        6: 25,
        7: 29,
        8: 33,
        9: 37,
        10: 39,
        11: 40,
        12: 41,
        13: 43,
        14: 44,
        15: 45,
        16: 47,
        17: 48,
        18: 49,
        19: 51,
        20: 53,
        21: 54,
        22: 55,
        23: 57,
        24: 58,
        25: 59,
        26: 61,
        27: 62,
        28: 63,
        29: 65,
        30: 66,
        31: 68,
        32: 72,
        33: 77,
        34: 81,
        35: 86,
        36: 90,
        37: 95,
        38: 100,
      },
      "foreign-lang": {
        1: 2,
        2: 3,
        3: 4,
        4: 5,
        5: 7,
        6: 8,
        7: 9,
        8: 10,
        9: 11,
        10: 13,
        11: 14,
        12: 15,
        13: 16,
        14: 18,
        15: 19,
        16: 20,
        17: 21,
        18: 22,
        19: 24,
        20: 25,
        21: 26,
        22: 27,
        23: 28,
        24: 29,
        25: 30,
        26: 31,
        27: 32,
        28: 33,
        29: 34,
        30: 36,
        31: 37,
        32: 38,
        33: 39,
        34: 40,
        35: 41,
        36: 42,
        37: 43,
        38: 44,
        39: 45,
        40: 46,
        41: 48,
        42: 49,
        43: 50,
        44: 51,
        45: 52,
        46: 53,
        47: 54,
        48: 55,
        49: 56,
        50: 57,
        51: 58,
        52: 60,
        53: 61,
        54: 62,
        55: 63,
        56: 64,
        57: 65,
        58: 66,
        59: 67,
        60: 68,
        61: 69,
        62: 70,
        63: 71,
        64: 73,
        65: 74,
        66: 75,
        67: 76,
        68: 77,
        69: 78,
        70: 79,
        71: 80,
        72: 81,
        73: 82,
        74: 84,
        75: 86,
        76: 88,
        77: 90,
        78: 92,
        79: 94,
        80: 96,
        81: 98,
        82: 100,
      },
      chinese: {
        1: 2,
        2: 3,
        3: 4,
        4: 5,
        5: 7,
        6: 8,
        7: 9,
        8: 10,
        9: 12,
        10: 13,
        11: 14,
        12: 15,
        13: 17,
        14: 18,
        15: 19,
        16: 20,
        17: 22,
        18: 23,
        19: 24,
        20: 25,
        21: 27,
        22: 28,
        23: 29,
        24: 30,
        25: 32,
        26: 33,
        27: 34,
        28: 35,
        29: 37,
        30: 38,
        31: 39,
        32: 40,
        33: 42,
        34: 43,
        35: 44,
        36: 45,
        37: 47,
        38: 48,
        39: 49,
        40: 50,
        41: 52,
        42: 53,
        43: 54,
        44: 55,
        45: 57,
        46: 58,
        47: 59,
        48: 60,
        49: 62,
        50: 63,
        51: 64,
        52: 65,
        53: 67,
        54: 68,
        55: 69,
        56: 70,
        57: 72,
        58: 73,
        59: 74,
        60: 75,
        61: 77,
        62: 78,
        63: 79,
        64: 80,
        65: 82,
        66: 83,
        67: 84,
        68: 85,
        69: 87,
        70: 88,
        71: 89,
        72: 90,
        73: 92,
        74: 93,
        75: 94,
        76: 95,
        77: 97,
        78: 98,
        79: 99,
        80: 100,
      },
    };
    const thresholds = {
      "math-pro": 27,
      russian: 36,
      chemistry: 36,
      biology: 36,
      physics: 36,
      history: 32,
      literature: 32,
      social: 42,
      informatics: 40,
      geography: 37,
      "foreign-lang": 22,
      chinese: 22,
    };
    const thresholdMap = {
      "math-pro": 27,
      russian: 36,
      chemistry: 36,
      biology: 36,
      physics: 36,
      history: 32,
      literature: 32,
      social: 42,
      informatics: 40,
      geography: 37,
      "foreign-lang": 22,
      chinese: 22,
    };
    document.querySelectorAll(".table-wrapper table").forEach((tbl) => {
      const details = tbl.closest("details");
      if (!details) return;
      const id = details.id;
      const thr = thresholdMap[id];
      if (!thr) return;
      const rows = tbl.querySelectorAll("tbody tr");
      for (const row of rows) {
        const cells = row.querySelectorAll("td");
        if (cells.length >= 2) {
          const t = Number(cells[1].textContent.trim());
          if (t <= thr) {
            row.style.backgroundColor = "#fef2f2";
            row.setAttribute("data-below-threshold", "true");
          }
        }
      }
    });
    const $s = document.getElementById("subject");
    const $p = document.getElementById("ege-calc-primary");
    const $r = document.getElementById("result");
    const $b = document.getElementById("calc-btn");
    if (!$s || !$p || !$r || !$b) return;
    $b.addEventListener("click", () => {
      const subj = $s.value;
      const p = Number($p.value);
      if (!Number.isInteger(p) || p < 0) {
        $r.innerHTML =
          '<span style="color: #ef4444;">Введите корректное целое количество первичных баллов.</span>';
        return;
      }
      const table = maps[subj] || {};
      const t = table[p];
      if (t === undefined) {
        $r.innerHTML =
          '<span style="color: #ef4444;">Для введённого первичного балла нет прямого соответствия в таблице (или значение вне диапазона). Проверьте число.</span>';
        return;
      }
      const thr = thresholds[subj] || 0;
      const passed = t >= thr;
      const badgeColor = passed ? "#065f46" : "#991b1b";
      const badgeBg = passed ? "#ecfdf5" : "#fef2f2";
      const badgeText = passed ? "порог пройден" : "порог не пройден";
      $r.innerHTML =
        'Вторичные (тестовые): <strong style="font-size: 18px;">' +
        t +
        "</strong> " +
        (thr
          ? '&nbsp; <span style="display: inline-block; padding: 2px 8px; border-radius: 9999px; font-size: 12px; background: ' +
            badgeBg +
            "; color: " +
            badgeColor +
            ';">' +
            badgeText +
            "</span>"
          : "");
    });
    $p.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        $b.click();
      }
    });
  })();
</script>
