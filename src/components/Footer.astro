---
/** src/components/SiteFooter.astro */
import { getCollection } from "astro:content";
import { slugify } from "../lib/slugify.ts"; // ← поправь путь при необходимости

interface Props {
  categories?: string[];
  logoSrc?: string;
  logoAlt?: string;
}

const {
  categories: providedCategories = [],
  logoSrc = "/logo.svg",
  logoAlt = "School Media",
} = Astro.props as Props;

// собираем список категорий
let categories: string[] = providedCategories;
if (categories.length === 0) {
  try {
    const articles = await getCollection("articles");
    const set = new Set<string>();
    for (const a of articles) {
      const cat = (a.data as any).category as string | undefined;
      if (cat) set.add(cat.trim());
    }
    categories = Array.from(set).sort((a, b) => a.localeCompare(b, "ru"));
  } catch {
    categories = [];
  }
}

const year = new Date().getFullYear();
---

<footer class="site-footer" role="contentinfo">
  <div class="footer-top">
    <!-- Колонка 1: логотип + служебные + RSS/Sitemap + Хочу стать автором -->
    <div class="col col-brand">
      <a class="brand" href="/" aria-label="На главную">
        <img
          src={logoSrc}
          alt={logoAlt}
          width="140"
          height="40"
          loading="lazy"
        />
      </a>

      <ul class="legal" aria-label="Служебные документы">
        <li><a href="/privacy">Политика конфиденциальности</a></li>
        <li><a href="/terms">Пользовательское соглашение</a></li>
        <li><a href="/data">Обработка данных</a></li>
      </ul>

      <ul class="extra-links" aria-label="Служебные ссылки">
        <li><a href="/rss.xml">RSS</a></li>
        <li><a href="/sitemap.xml">Sitemap</a></li>
        <li><a href="/become-author">Хочу стать автором</a></li>
      </ul>
    </div>

    <!-- Колонка 2: категории -->
    <div class="col col-cats">
      <h3 class="col-title">Категории</h3>
      {
        categories.length > 0 ? (
          <ul class="cats-list">
            {categories.map((cat) => {
              const slug = slugify(cat);
              return (
                <li>
                  <a href={`/category/${slug}/`}>{cat}</a>
                </li>
              );
            })}
          </ul>
        ) : (
          <p class="muted">Категории пока не найдены</p>
        )
      }
    </div>

    <!-- Колонка 3: соцсети -->
    <div class="col col-social">
      <h3 class="col-title">Наши соцсети</h3>
      <nav class="socials" aria-label="Социальные сети">
        <!-- YouTube -->
        <a
          class="social"
          href="https://www.youtube.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="YouTube"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M23.5 6.2a4 4 0 0 0-2.8-2.8C18.9 3 12 3 12 3s-6.9 0-8.7.4A4 4 0 0 0 .5 6.2 41.5 41.5 0 0 0 0 12a41.5 41.5 0 0 0 .5 5.8 4 4 0 0 0 2.8 2.8C5.1 21.9 12 21.9 12 21.9s6.9 0 8.7-.4a4 4 0 0 0 2.8-2.8A41.5 41.5 0 0 0 24 12a41.5 41.5 0 0 0-.5-5.8zM9.6 15.5v-7l6 3.5-6 3.5z"
              fill="currentColor"></path>
          </svg>
        </a>
        <!-- VK -->
        <a
          class="social"
          href="https://vk.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="VK"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M12.7 17h1.4s.4 0 .6-.2c.2-.1.2-.5.2-.5s0-1.6.7-1.8c.7-.2 1.6 1.5 2.6 2.1.7.5 1.2.4 1.2.4l2.5-.1s1.3-.1.7-1.1c-.1-.2-.5-.7-1.2-1.3-1-1-1.8-2-2-2.3-.5-.7-.4-1 .1-1.6.5-.6 1.1-1.6 1.1-1.6s.3-.6 0-.9c-.4-.3-1.1-.2-1.1-.2h-2.4s-.5 0-.8.2c-.3.2-.4.6-.4.6s-.7 1.8-1.6 3.2c-.5.7-.8.9-1.1.8-.3-.2-.2-1.1-.2-1.7 0-1.8.3-2.6-.6-2.8-.3-.1-.5-.1-1.2-.1-1 0-1.8 0-2.2.2-.3.1-.6.5-.5.5s.5.1.7.4c.2.4.2 1.2.2 1.2s.1 2.2-.3 2.5c-.3.3-.8-.2-1.8-1.7-.5-.8-.9-1.6-.9-1.6s-.1-.3-.4-.5c-.3-.2-.7-.3-.7-.3H3.6s-.6 0-.8.2c-.2.2 0 .7 0 .7s2.4 5 5.2 7.5c2.5 2.2 5.3 2.1 5.3 2.1z"
              fill="currentColor"></path>
          </svg>
        </a>
        <!-- Telegram -->
        <a
          class="social"
          href="https://t.me/+KznfEhtzkeNlZjIy"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Telegram"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M9.7 14.7 9.4 19c.5 0 .7-.2 1-.5l2.4-2.3 5 3.6c.9.5 1.6.3 1.8-.8l3.3-15.6v0c.3-1.2-.4-1.6-1.3-1.3L1.3 9.4c-1.2.5-1.2 1.1-.2 1.3l5.8 1.8 13.4-8.5c.6-.4 1.1-.2.7.2L9.7 14.7z"
              transform="scale(.9) translate(1.5 1.3)"
              fill="currentColor"></path>
          </svg>
        </a>
        <!-- TikTok -->
        <a
          class="social"
          href="https://www.tiktok.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="TikTok"
        >
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path
              d="M21 8.1a7.7 7.7 0 0 1-4.9-1.7v7a5.9 5.9 0 1 1-5.9-5.9c.3 0 .6 0 .9.1v2.9a3 3 0 1 0 2.2 2.9V2h2.7a7.7 7.7 0 0 0 4.9 4.1v2z"
              fill="currentColor"></path>
          </svg>
        </a>
      </nav>
    </div>
  </div>

  <div class="footer-bottom">
    <p class="copyright">© {year} School Media</p>
  </div>
</footer>

<style>
  :root {
    --footer-bg: #27292f;
    --text: #e7e9ee;
    --muted: #a8adb8;
    --link: #c7d2fe;
    --link-hover: #ffffff;
    --divider: rgba(255, 255, 255, 0.08);
    --col-gap: clamp(16px, 3.5vw, 32px);
    --max-w: var(--page-max-width, 1300px);
    --pad-x: min(5vw, 50px);
  }

  .site-footer {
    background: var(--footer-bg);
    color: var(--text);
    margin-top: auto;
  }

  .footer-top {
    max-width: var(--max-w);
    margin: 0 auto;
    padding: 28px var(--pad-x) 18px;
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--col-gap);
    border-bottom: 1px solid var(--divider);
  }

  @media (min-width: 720px) {
    .footer-top {
      grid-template-columns: 1.2fr 1fr 1fr;
      align-items: start;
    }
  }

  .col-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 12px;
    color: #fff;
    letter-spacing: 0.2px;
  }

  /* Колонка 1 */
  .brand {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }

  .legal,
  .extra-links {
    list-style: none;
    padding: 0;
    margin: 0 0 12px;
    display: grid;
    gap: 8px;
  }

  .legal a,
  .extra-links a {
    color: var(--muted);
    text-decoration: none;
  }
  .legal a:hover,
  .extra-links a:hover {
    color: var(--link-hover);
    text-decoration: underline;
  }

  /* Колонка 2 */
  .cats-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .cats-list li {
    margin: 0 0 6px;
  }
  .cats-list a {
    color: var(--link);
    text-decoration: none;
    border-radius: 6px;
    padding: 2px 4px;
  }
  .cats-list a:hover {
    color: var(--link-hover);
    background: rgba(255, 255, 255, 0.06);
  }

  .muted {
    color: var(--muted);
    margin: 4px 0 0;
  }

  /* Колонка 3 */
  .socials {
    display: flex;
    gap: 10px;
    margin: 0 0 10px;
  }
  .social {
    inline-size: 40px;
    block-size: 40px;
    display: grid;
    place-items: center;
    color: #fff;
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid var(--divider);
    border-radius: 10px;
    transition:
      transform 0.15s ease,
      background 0.15s ease,
      color 0.15s ease;
  }
  .social:hover {
    transform: translateY(-2px);
    background: rgba(255, 255, 255, 0.12);
    color: var(--link-hover);
  }
  .social svg {
    width: 22px;
    height: 22px;
  }

  /* Нижняя полоса */
  .footer-bottom {
    max-width: var(--max-w);
    margin: 0 auto;
    padding: 14px var(--pad-x) 22px;
  }
  .copyright {
    text-align: center;
    color: var(--muted);
    font-size: 0.9rem;
    margin: 0;
  }
</style>
