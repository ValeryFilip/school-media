---
import MainLayout from "../layouts/MainLayout.astro";
import StepikHero from "../components/stepik/stepikHero.astro";
import {
  buildCourseJsonLd,
  buildProductJsonLd,
  buildVideoJsonLd,
  buildFAQJsonLd,
} from "../lib/seoData";

import CourseWhy from "../components/stepik/CourseWhy.astro";
import ReviewsSection from "../components/stepik/ReviewsSection.astro";
import SupportSection from "../components/stepik/SupportSection.astro";
import PriceBlock from "../components/stepik/PriceBlock.astro";
import CourseOffer from "../components/stepik/CourseOffer.astro";
import UnisMarquee from "../components/mainpage/UnisMarquee.astro";
import MegaSection from "../components/stepik/MegaSection.astro";
import PaymentPopup from "../components/stepik/PaymentPopup.astro";

/* Готовый FAQ-компонент (тот, что ты прислал) */
import Faq from "../components/mainpage/Faq.astro";

/* Готовый блок автора (существующий у тебя компонент) */
import AuthorSection from "../components/mainpage/AuthorSection.astro";

/* SEO */
const seo = {
  title: "Курс по ОВР для ЕГЭ 2026 | Химия ЕГЭ с Валерием Филипенко",
  description:
    "Онлайн-курс по ОВР для ЕГЭ: теория, практика, тренажёры и поддержка. Начни бесплатно и выйди на 80–100 баллов!",
  image: "/images/technical/og-home.png",
};

/* Слайды платформы */
const platformProps = {
  id: "platform",
  heading: "Как проходит обучение на платформе",
  autoplayMs: 6000,
  slides: [
    {
      img: {
        src: "/images/stepik/gifs/platform.webm",
        alt: "Платформа обучения",
      },
      step: "Платформа",
      title: "Уникальная платформа Stepik",
      text: "Современная платформа с интуитивным интерфейсом, мобильным приложением и удобной навигацией. Все материалы доступны в одном месте.",
      btnText: "Перейти к регистрации",
      href: "#offer",
    },
    {
      img: {
        src: "/images/stepik/gifs/course.webm",
        alt: "Большой курс",
      },
      step: "Курс",
      title: "Большой курс, наполненный контентом",
      text: "Полный курс по неорганической химии с 26 часами видео и 1085 заданиями. Не нужно ничего искать дополнительно - все есть в курсе.",
      btnText: "Начать обучение",
      href: "#offer",
    },
    {
      img: {
        src: "/images/stepik/gifs/video.webm",
        alt: "Видеоуроки",
      },
      step: "Видео",
      title: "Качественные видеоуроки",
      text: "Подробные видеоуроки с объяснением теории, разбором примеров и решением задач. Материал подается понятно и структурированно.",
      btnText: "Смотреть видео",
      href: "#offer",
    },
    {
      img: {
        src: "/images/stepik/gifs/practice.webm",
        alt: "Практические задания",
      },
      step: "Практика",
      title: "Интерактивная практика",
      text: "Более 1000 заданий с автопроверкой и развернутыми ответами. От простых упражнений до заданий уровня ЕГЭ по химии.",
      btnText: "К практике",
      href: "#offer",
    },
    {
      img: {
        src: "/images/stepik/gifs/help.webm",
        alt: "Поддержка и вопросы",
      },
      step: "Поддержка",
      title: "Постоянная поддержка",
      text: "Есть вопросы? Задавайте их в общем чате или на платформе Stepik. Мы всегда готовы помочь и объяснить сложные моменты.",
      btnText: "Задать вопрос",
      href: "#offer",
    },
    {
      img: {
        src: "/images/stepik/gifs/materials.webm",
        alt: "Файлы и материалы",
      },
      step: "Файлы",
      title: "Дополнительные материалы",
      text: "Чек-листы, схемы, таблицы и другие полезные материалы для закрепления знаний. Все файлы доступны для скачивания.",
      btnText: "Посмотреть файлы",
      href: "#offer",
    },
  ],
};

/* Модули курса */
const modulesProps = {
  id: "modules",
  title: "Содержание курса",
  infoHtml: "5 часов видео<br>125 заданий",
  modules: [
    {
      lessons: "3 урока",
      title: "Введение в ОВР",
      items: [
        "Все об ОВР",
        "Признаки и классификация ОВР",
        "Определение окислителя и восстановителя",
      ],
    },
    {
      lessons: "2 урока",
      title: "Электронный баланс",
      items: ["Электронный баланс", "Метод электронного баланса Часть 2"],
    },
    {
      lessons: "2 урока",
      title: "Составление ОВР",
      items: ["Составление ОВР (схемы)", "Тренажер"],
    },
    {
      lessons: "2 урока",
      title: "Тренажеры и разбор",
      items: ["Тренажер заданий №19", "Задания с развернутым ответом 29"],
    },
    {
      lessons: "2 урока",
      title: "Подборка заданий №29",
      items: ["29 задания", "Тренажер заданий №29"],
    },
  ],
};

/* Скиллы */
const skillsProps = {
  id: "skills",
  title: "Чему вы научитесь на этом курсе",
  rows: [
    [
      "Понимать ОВР и их признаки",
      "Определять степени окисления и баланс электронов",
      "Владеть методом электронного баланса",
    ],
    [
      "Составлять уравнения ОВР по схемам",
      "Выбирать окислитель/восстановитель и среду реакции",
      "Решать задания №19 и №29 формата ЕГЭ",
    ],
    [
      "Разбирать неоднозначные продукты ОВР",
      "Уверенно проходить тренажёры и развернутые задачи",
      "Применять типовые паттерны ОВР на практике",
    ],
  ],
};

/* Блок «почему курс работает» */
const courseWhyProps = {
  id: "course-why",
  className: "somic-font",
  image: { src: "/images/stepik/science.webp", alt: "Наука" },
  title: "Курс, который работает <br>и вот почему",
  topCards: [
    {
      title: "Структура",
      text: "Только нужная для ЕГЭ информация, ничего лишнего на курсе нет!",
    },
    {
      title: "Видео",
      text: "Никаких пустых разговоров, только короткие ролики с концентратом информации.",
    },
  ],
  bottomCards: [
    {
      title: "Практика",
      text: "Больше 1000 заданий пратики. Как развернутые, так и тестовые задания с автопроверкой.",
    },
    {
      title: "График",
      text: "Расписания нет, курс самостоятельный. Сколько хочешь, столько и занимаешься. Можно начинать когда угодно!",
    },
  ],
  verticalCard: {
    title: "Постоянная поддержка!",
    text: "Всегда можно задать вопрос в общем чате или на платформе stepik. Мы всегда придем к Вам на помощь и не оставим один на один с проблемами!",
  },
  footer: {
    title: "Полный курс неорганической химии!",
    text: "В данном курсе есть все необходимое для подготовки с 0. Не нужно ничего искать дополнительно.",
    ctaText: "Приобрести курс",
    ctaHref: "#offer",
    target: "_self",
    rel: "noopener",
  },
};

/* Отзывы (бегущие ленты) */
const reviewsProps = {
  id: "reviews",
  titleHtml: "Студенты довольны обучением",
  hintHtml: "нажми на картинку для прочтения",
  stats: [
    {
      value: "98%",
      text: "выпускников отмечают, что курсы Валерия Филипенко помогли достичь поставленной цели и вырасти в баллах",
    },
    {
      value: "90%",
      text: "выпускников готовы рекомендовать обучение на курсе Валерия Филипенко",
    },
    {
      value: "4,9 ⭐",
      text: "средний рейтинг всех курсов Валерия Филипенко. На основании независимых отзывов на платформе Stepik",
    },
  ],
  speedTopSec: 50,
  speedBottomSec: 40,
  moreReviewsHref: "https://stepik.org/a/183475?utm_source=cite",
  moreReviewsText: "больше отзывов",
};

/* Блок «ты не один» */
const supportProps = {
  id: "support",
  heading: "А я точно справлюсь самостоятельно?",
  accent: "Да, конечно!",
  leftCards: [
    {
      title: "Готовимся с полного нуля",
      text: "Весь материал курса подготовлен так, что даже самый новичок в химии сможет овладеть им. Нужны лишь базовые школьные знания.",
      icon: "✔",
    },
    {
      title: "Задания идут от простого к сложному",
      text: "Все задания на модулях собраны так, чтобы вы могли тренироваться на простых и постепенно переходить к сложным!",
      icon: "✔",
    },
  ],
  rightTitle: "Ты не один, мы всегда рядом!",
  rightText:
    "Ты всегда можешь задать вопрос на платформе или в нашем дружном чате, где тебе всегда помогут и объяснят, как лучше поступить или решить задание!",
  rightImg: {
    src: "/images/stepik/researcher.webp",
    alt: "Иллюстрация исследователя",
  },
};

/* Цена с текстурой (локальные числа) */
const priceProps = {
  id: "price",
  amount: "15 000",
  currency: "руб",
  mainText:
    "Именно столько стоит объем материала этого курса, если заниматься с репетитором.",
  subTextHtml:
    "В данном самостоятельном курсе вы получите всё это за <strong>990 ₽</strong> со скидкой <strong>95%</strong>.",
  textured: true,
  textureSrc:
    "https://img.freepik.com/free-vector/crumpled-paper-texture_1048-2259.jpg",
};

/* Оффер с пакетами */
const offerProps = {
  id: "offer",
  badges: [
    { text: "Обучение онлайн" },
    { text: "Доступ навсегда" },
    { text: "Упор на практику" },
  ],
  title: "Полный курс по написанию ОВР на ЕГЭ",
  subtitle: "Что вы получите при покупке курса?",
  bullets: [
    { text: "Теория по написанию ОВР на ЕГЭ" },
    { text: "5 часов видео без воды" },
    { text: "125 заданий ЕГЭ" },
    { text: "Короткие видео 10–40 мин" },
    { text: "Чат поддержки" },
    { text: "Удобная платформа и приложение" },
    { text: "Автопроверка заданий" },
    { text: "Свободное расписание" },
  ],
  price: "990 ₽",
  oldPrice: "1 300₽",
  buy: {
    text: "Курс на Stepik",
    href: "https://stepik.org/a/183475?utm_source=cite&utm_medium=offerpage",
    target: "_blank",
    rel: "noopener",
  },
  buyWithDiscount: {
    text: "Оплатить со скидкой 5%",
    href: "#",
    target: "_self",
    rel: "noopener",
    onClick:
      "openPaymentPopup('https://stepik.org/a/183475/pay?promo=d9fe599bb83b41b4&utm_source=cite&utm_medium=offerpage&utm_campaign=5%25')",
  },
  headerImage: { src: "/images/stepik/Science-pana.webp", alt: "" },
  ctaColor: "#FF725E",
  packages: [
    {
      title: "Выгоднее взять пакет курсов",
      price: "11 100 ₽",
      oldPrice: "15 500 ₽",
      discount: "-26%",
      text: "Общая + неорганическая + органическая химии",
      href: "https://stepik.org/a/238138?utm_source=cite&utm_medium=ovr",
      target: "_blank",
      rel: "noopener",
      ctaText: "Подробнее",
      buyWithDiscount: {
        text: "Оплатить со скидкой 5%",
        href: "#",
        target: "_self",
        rel: "noopener",
        onClick:
          "openPaymentPopup('https://stepik.org/a/238138/pay?promo=90c9f6c96cad6e37&utm_source=cite&utm_medium=ovr&utm_campaign=%25')",
      },
      icon: { src: "/images/stepik/planet.webp", alt: "" },
    },
    {
      title: "Еще один выгодный пакет курсов",
      price: "6 700 ₽",
      oldPrice: "10 000 ₽",
      discount: "-25%",
      text: "Общая + неорганическая химии",
      href: "https://stepik.org/a/238136?utm_source=cite&utm_medium=ovr",
      target: "_blank",
      rel: "noopener",
      ctaText: "Подробнее",
      buyWithDiscount: {
        text: "Оплатить со скидкой 5%",
        href: "#",
        target: "_self",
        rel: "noopener",
        onClick:
          "openPaymentPopup('https://stepik.org/a/238136/pay?promo=ee3fee815d6fc976&utm_source=cite&utm_medium=ovr&utm_campaign=5%25')",
      },
      icon: { src: "/images/stepik/book.webp", alt: "" },
    },
  ],
};

/* === FAQ ПРОПСЫ (только «вытащил» на страницу) === */
const faqProps = {
  title: "Часто задаваемые вопросы",
  headingId: "faq-title",
  singleOpen: true, // если хочешь, чтобы можно было открывать несколько — поставь false (см. оболочку ниже)
  items: [
    {
      q: "Что значит самостоятельный курс?",
      a: "Самостоятельный курс или самостоятельная подготовка к ЕГЭ по химии подразумевает, что ученик сам проходит материал по записанным видео‑урокам. Затем самостоятельно решает задания, учит материал. При этом на курсе нет вебинаров и индивидуальных занятий. Однако всегда можно задать вопрос в общем чате или на платформе Stepik.",
    },
    {
      q: "А если мне не понравится курс, я могу вернуть деньги?",
      a: "Да, предусмотрен возврат средств при условии, что пройдено менее 20% курса и с момента покупки прошло менее 14 дней.",
    },
    {
      q: "На курсе есть домашние задания?",
      a: "На платформе Stepik размещено более 1000 заданий с автопроверкой. Они и выполняют роль домашнего задания.",
    },
    {
      q: "Почему такая низкая цена?",
      a: "Курс продаётся по низкой цене, потому что он полностью самостоятельный: нет вебинаров, индивидуальных занятий и наёмных преподавателей.",
    },
    {
      q: "Есть ли конспекты на курсе?",
      a: "На курсе есть файлы для печати (таблицы, схемы). Целых готовых конспектов нет — рекомендуем писать их самостоятельно для лучшего запоминания.",
    },
    {
      q: "Предусмотрена ли рассрочка оплаты?",
      a: "Да, рассрочку можно оформить на Stepik через Яндекс или Тинькофф.",
    },
  ],
};

/* === ПРОПСЫ АВТОРА (блок у тебя уже готов; ниже — типичный набор) === */
const authorProps = {
  id: "author",
  heading: "Автор курса",
  name: "Валерий Филипенко",
  title: "Преподаватель химии и автор ЕГЭ-курсов",
  photo: {
    src: "https://i.ibb.co/3C9ZP1L/teacher.png",
    alt: "Валерий Филипенко",
  },
  facts: [
    "10+ лет подготовки к ЕГЭ",
    "Средний результат учеников: 85+",
    "Автор задачников и методичек",
    "Партнёр ведущих платформ",
  ],
  socials: [
    { href: "https://t.me/chemestrika", label: "Telegram" },
    { href: "https://vk.com", label: "VK" },
  ],
};

/* === MEGA SECTION ПРОПСЫ === */
const megaSectionProps = {
  id: "mega-section",
  innerGap: "var(--space-50)",
  platform: platformProps,
  modules: modulesProps,
  skills: skillsProps,
  bottomCta: {
    href: "#offer",
    text: "Записаться на курс",
    target: "_self",
    rel: "noopener",
  },
};

// Генерация JSON-LD
const origin = Astro.url.origin;
const pageUrl = `${origin}${Astro.url.pathname}`;

// Course JSON-LD
const courseJsonLd = buildCourseJsonLd({
  origin,
  url: pageUrl,
  name: seo.title.replace(" | Химия ЕГЭ с Валерием Филипенко", ""),
  description: seo.description.trim(),
  ratingValue: 4.9,
  reviewCount: reviewsProps.stats.find((s) => s.value.includes("4,9"))
    ? 100
    : undefined,
  keywords: [
    "ОВР ЕГЭ",
    "окислительно-восстановительные реакции",
    "задание 29 ЕГЭ",
    "курс ОВР",
    "реакции ЕГЭ",
  ],
});

// Product JSON-LD
const productPrice = offerProps.price.replace(/[^\d]/g, "");
const productJsonLd = buildProductJsonLd({
  origin,
  url: pageUrl,
  name: seo.title.replace(" | Химия ЕГЭ с Валерием Филипенко", ""),
  description: seo.description.trim(),
  price: productPrice,
  priceCurrency: "RUB",
});

// VideoObject JSON-LD (берем первое видео из платформы)
const videoSlide = platformProps.slides.find(
  (s) => s.img.src.includes(".webm") || s.img.src.includes(".mp4"),
);
const videoJsonLd = videoSlide
  ? buildVideoJsonLd({
      origin,
      pageUrl,
      name: videoSlide.title,
      description: videoSlide.text,
      contentUrl: videoSlide.img.src,
    })
  : null;

// FAQPage JSON-LD
const faqJsonLd = buildFAQJsonLd(faqProps.items);
---

<MainLayout
  title={seo.title}
  description={seo.description}
  image={seo.image}
  seoType="website"
  showBreadcrumbs={false}
  logoSrc="/favicon.svg"
  ctaHref="/courses"
  courseJsonLd={courseJsonLd}
  productJsonLd={productJsonLd}
  videoJsonLd={videoJsonLd}
  faqJsonLd={faqJsonLd}
>
  <section id="hero">
    <StepikHero
      labels={["Курс", "Химия ЕГЭ 2026", "ОВР"]}
      title="Курс по написанию ОВР на ЕГЭ 2026"
      desc="ОВР - основа неорганики и умение писать эти реакции поможет вам решать все задания из неорганической химии, особенно 29 и 31."
      ctas={[
        {
          href: "#offer",
          text: "Забронировать скидку", // ← текст кнопки
          variant: "primary",
        },
        {
          href: "#author",
          text: "Подробнее", // ← текст ссылки
          variant: "ghost",
        },
      ]}
      image={{
        src: "/images/stepik/hero-image-neorg.webp",
        alt: " — подготовка к ЕГЭ по химии",
        width: 1200,
        height: 800,
      }}
      features={[
        { title: "Доступ к курсу", text: "Остается навсегда" },
        {
          title: "+20баллов на ЕГЭ",
          text: "После курса увеличите свой результат",
        },
        {
          title: "125 заданий на курсе",
          text: "Курс нацелен на практику, вы будете много решать.",
        },
        {
          title: "Рейтинг курса 5⭐",
          text: "На основании независимых оценок stepik",
        },
      ]}
    />
  </section>

  <section id="author">
    <AuthorSection />
  </section>

  <section id="platform">
    <MegaSection
      id={megaSectionProps.id}
      innerGap={megaSectionProps.innerGap}
      platform={{
        heading: megaSectionProps.platform.heading,
        autoplayMs: megaSectionProps.platform.autoplayMs,
        slides: megaSectionProps.platform.slides,
      }}
      modules={megaSectionProps.modules}
      skills={megaSectionProps.skills}
      bottomCta={{
        href: megaSectionProps.bottomCta.href,
        text: megaSectionProps.bottomCta.text,
        target: megaSectionProps.bottomCta.target as "_blank" | "_self",
        rel: megaSectionProps.bottomCta.rel,
      }}
    />
  </section>

  <section id="course-why">
    <CourseWhy
      id={courseWhyProps.id}
      className={courseWhyProps.className}
      image={courseWhyProps.image}
      title={courseWhyProps.title}
      topCards={courseWhyProps.topCards as [
        (typeof courseWhyProps.topCards)[0],
        (typeof courseWhyProps.topCards)[1],
      ]}
      bottomCards={courseWhyProps.bottomCards as [
        (typeof courseWhyProps.bottomCards)[0],
        (typeof courseWhyProps.bottomCards)[1],
      ]}
      verticalCard={courseWhyProps.verticalCard}
      footer={courseWhyProps.footer}
    />
  </section>

  <section id="reviews">
    <ReviewsSection {...reviewsProps} />
  </section>

  <section id="support">
    <SupportSection
      id={supportProps.id}
      heading={supportProps.heading}
      accent={supportProps.accent}
      leftCards={supportProps.leftCards as [
        (typeof supportProps.leftCards)[0],
        (typeof supportProps.leftCards)[1],
      ]}
      rightTitle={supportProps.rightTitle}
      rightText={supportProps.rightText}
      rightImg={supportProps.rightImg}
    />
  </section>

  <section id="price">
    <PriceBlock {...priceProps} />
  </section>

  <section id="offer">
    <CourseOffer
      id={offerProps.id}
      badges={offerProps.badges}
      title={offerProps.title}
      subtitle={offerProps.subtitle}
      bullets={offerProps.bullets}
      price={offerProps.price}
      oldPrice={offerProps.oldPrice}
      buy={offerProps.buy}
      buyWithDiscount={offerProps.buyWithDiscount}
      headerImage={offerProps.headerImage}
      ctaColor={offerProps.ctaColor}
      packages={offerProps.packages as [
        (typeof offerProps.packages)[0],
        (typeof offerProps.packages)[1],
      ]}
    />
  </section>

  <section id="universities">
    <UnisMarquee />
  </section>

  {/* Оболочка для FAQ (если нужно, чтобы открывался только один пункт) */}
  <section id="faq">
    <Faq {...faqProps} />
  </section>
  <div {...faqProps.singleOpen ? {} : { "data-faq-singleopen": "0" }}></div>

  {/* Попап для оплаты */}
  <PaymentPopup
    stepikUrl="https://stepik.org/a/183475/pay?promo=d9fe599bb83b41b4"
    title="Оплата курса со скидкой"
    closeText="Закрыть"
  />
</MainLayout>
